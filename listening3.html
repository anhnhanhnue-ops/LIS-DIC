<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bài tập Dictation - Ace Accommodation</title>
    <style>
        :root {
            --primary-color: #28a745;
            --bg-color: #f4f7f6;
            --highlight-color: #fff176;
            --secondary-color: #007bff;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg-color);
            line-height: 1.6;
            padding: 20px;
            display: flex;
            justify-content: center;
        }

        .container {
            max-width: 800px;
            width: 100%;
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        h2 {
            color: #333;
            text-align: center;
            margin-bottom: 25px;
        }

        .audio-section {
            background: #e9ecef;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            margin-bottom: 20px;
        }

        audio {
            width: 100%;
        }

        .speed-controls {
            margin-top: 15px;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            flex-wrap: wrap;
        }

        .btn-speed {
            background: #fff;
            border: 1px solid #ccc;
            padding: 5px 15px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s;
        }

        .btn-speed.active {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        .shortcut-hint {
            font-size: 12px;
            color: #666;
            margin-top: 10px;
            font-style: italic;
        }

        .input-section {
            margin-bottom: 20px;
        }

        label {
            font-weight: bold;
            display: block;
            margin-bottom: 10px;
        }

        textarea {
            width: 100%;
            height: 200px;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            box-sizing: border-box;
            resize: vertical;
            transition: border-color 0.3s;
        }

        textarea:focus {
            border-color: var(--secondary-color);
            outline: none;
        }

        .btn-check {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 12px 25px;
            font-size: 18px;
            border-radius: 6px;
            cursor: pointer;
            width: 100%;
            transition: background 0.3s;
        }

        .btn-check:hover {
            background-color: #218838;
        }

        #resultArea {
            margin-top: 30px;
            display: none;
        }

        .accuracy-badge {
            font-size: 24px;
            font-weight: bold;
            color: var(--secondary-color);
            text-align: center;
            margin-bottom: 15px;
        }

        .comparison-box {
            background: #fff;
            border: 1px solid #ccc;
            padding: 15px;
            border-radius: 8px;
            margin-top: 10px;
            white-space: pre-wrap;
            line-height: 1.8;
        }

        .diff-highlight {
            background-color: var(--highlight-color);
            padding: 2px 4px;
            border-radius: 3px;
            border-bottom: 1px solid orange;
        }

        .original-script {
            margin-top: 20px;
            background: #f8f9fa;
            padding: 15px;
            border-left: 5px solid var(--secondary-color);
        }
    </style>
</head>
<body>

<div class="container">
    <h2>Luyện Nghe Chép Chính Tả</h2>

    <div class="audio-section">
        <audio id="myAudio" controls>
            <source src="https://www.dropbox.com/scl/fi/0ez5iqrvrvxy4ser9wb1j/24_we-mp3cut.net.mp3?rlkey=c8wawmt5rsrqh8brvgqlajwet&st=bly7izt4&raw=1" type="audio/mpeg">
        </audio>
        
        <div class="speed-controls">
            <span>Tốc độ: </span>
            <button class="btn-speed" onclick="changeSpeed(0.75, this)">x0.75</button>
            <button class="btn-speed active" onclick="changeSpeed(1, this)">x1 (Chuẩn)</button>
            <button class="btn-speed" onclick="changeSpeed(1.25, this)">x1.25</button>
        </div>
        <div class="shortcut-hint">
            Mẹo: Nhấn <b>←</b> lùi 5s, <b>→</b> tiến 5s. Nhấn <b>Esc</b> để Play/Pause khi đang gõ.
        </div>
    </div>

    <div class="input-section">
        <label for="studentInput">Nhập nội dung nghe được:</label>
        <textarea id="studentInput" placeholder="Bắt đầu gõ tại đây..."></textarea>
    </div>

    <button class="btn-check" onclick="checkResult()">Kiểm tra kết quả</button>

    <div id="resultArea">
        <div class="accuracy-badge" id="accuracyScore"></div>
        <div id="comparisonDisplay" class="comparison-box"></div>

        <div class="original-script">
            <label>Lời thoại gốc:</label>
            <p id="originalTextDisplay"></p>
        </div>
    </div>
</div>

<script>
    const audio = document.getElementById('myAudio');
    const studentInput = document.getElementById('studentInput');
    const originalText = `Good morning, Ace Accommodation. How can I help you? Good morning. I’d like to organize some short-stay accommodation on the Gold Coast, please. Certainly. Who am I speaking to? Ms. McKinley. Sylvia McKinley. Could you spell your family name for me, please. It’s M-a-c-k-i-n-l-a-y. Thank you. And your first name is Sylvia? Yes. Is that with an I or a Y? Oh, Y, the old-fashioned way. That’s S-y-l-v-i-a. Thank you, Ms. McKinley. Now, just for our records, can you tell me what country you live in? Of course, it’s England. Actually. I thought so. Now, when are you coming? Well, at the moment we’re planning on arriving on July 26th. Oh, the 25th. That’s the last day of the public holiday, and it might be difficult to find something available on that date. No, we’re coming on the 26th of July. Oh, well, that’s fine then. We’ll have lots of good places vacant by then, although you wouldn’t be able to move in until late afternoon because our cleaning crew will need time to get everything ready for you. That suits us. Our flight won’t get in until early evening anyway. How many of you will that be? Just my sister and myself. And how long do you intend to stay? Oh, only a couple of weeks. We’d like to stay longer but we’ll have to get back to work. So you’re not coming on business, then? No, it’s just a holiday. Why? What difference does that make? Oh, you’d be surprised. Business people have different needs, you know—wireless Internet, even fax machines and photocopiers. No, we won’t need any of that stuff. We’ll be coming to relax and get away from all that kind of thing. Good. Now, what exactly are you looking for? A house, a duplex, or an apartment? What’s a duplex? Oh, that’s what you might call a townhouse or a unit. You know, two houses semi-detached on the same property. Oh, I see. I think an apartment will suit us just fine. And how many bedrooms? One or two. It depends on the size. My sister and I don’t mind sharing if it’s a decent-sized bedroom with two beds. Well, that makes it easier. And car parking—will you require a lock-up garage? They’re a little hard to find with an apartment. We’ll have a hire car. And as far as I know, there are no regulations concerning car parking. I think as long as it’s not parked on the street and is secure, there shouldn’t be any problems. Okay. Now I’m assuming you want something by the beach. Yes, that’s the idea. We want to enjoy the surf, sand, and sunshine. Okay, but before we settle on an area and discuss your price range, I’ll need to know about other necessities. What do you mean? Well, for example, do you want to be close to a shopping mall or the casino or the fun parks? Or do you want to be in a complex with or near a swimming pool? No, none of that really matters to us. But we’d like to have reasonable access to the motorway so that we can drive up to Brisbane to visit friends there. Well, there are quite a few lovely small towns to choose from. There’s Main Beach, which is north of Surfers Paradise, or Mermaid Waters, which is a bit further south, or Palm Beach, which is quite a bit further south. Mermaid Waters sounds delightful. Is it close to the motorway? Well, not really. The M1 is actually closest to Palm Beach, and prices are likely to be more reasonable there too. That’s settled then. Palm Beach it is. Now, if you’ll just give me your email address, I can send you information about the town and lots of photos. Well, my email is smac13@hotmail.com. And one final thing—how much are you looking to spend per week on accommodation? Do you want something at the luxury end of the market? You know, newly redecorated, great views, modern conveniences? Not necessarily. Could we get something clean, comfortable, and reasonable for $1200 a week? Could you stretch that to $1500 a week? I have got a property in mind that you’ll absolutely love, but you will have to go to $1500. $1200 wouldn’t cover it. Alright then, that’s our top limit. Good. I will get onto this straight away and there should be something in your inbox shortly.`;

    // 1. Thay đổi tốc độ
    function changeSpeed(speed, btn) {
        audio.playbackRate = speed;
        document.querySelectorAll('.btn-speed').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
    }

    // 2. Xử lý phím tắt
    window.addEventListener('keydown', function(e) {
        // Phím mũi tên trái: Lùi 5s
        if (e.key === 'ArrowLeft') {
            audio.currentTime = Math.max(0, audio.currentTime - 5);
            e.preventDefault(); // Ngăn cuộn trang
        }
        // Phím mũi tên phải: Tiến 5s
        if (e.key === 'ArrowRight') {
            audio.currentTime = Math.min(audio.duration, audio.currentTime + 5);
            e.preventDefault();
        }
        // Phím Esc: Tạm dừng/Phát (Dùng Esc vì phím Space sẽ bị xung đột khi đang gõ văn bản)
        if (e.key === 'Escape') {
            if (audio.paused) audio.play();
            else audio.pause();
        }
    });

    // 3. Kiểm tra kết quả
    function checkResult() {
        const val = studentInput.value;
        const resultArea = document.getElementById('resultArea');
        const comparisonDisplay = document.getElementById('comparisonDisplay');
        const accuracyScore = document.getElementById('accuracyScore');
        const originalTextDisplay = document.getElementById('originalTextDisplay');

        const clean = (text) => text.toLowerCase().replace(/[.,/#!$%^&*;:{}=\-_`~()?]/g, "").split(/\s+/).filter(x => x.length > 0);

        const originalWords = clean(originalText);
        const rawStudentWords = val.split(/\s+/).filter(x => x.length > 0);

        let correctCount = 0;
        let comparisonHTML = "";

        rawStudentWords.forEach((word) => {
            const cleanWord = word.toLowerCase().replace(/[.,/#!$%^&*;:{}=\-_`~()?]/g, "");
            if (originalWords.includes(cleanWord)) {
                comparisonHTML += word + " ";
                correctCount++;
            } else {
                comparisonHTML += `<span class="diff-highlight">${word}</span> `;
            }
        });

        const accuracy = Math.min(((correctCount / originalWords.length) * 100), 100).toFixed(1);

        accuracyScore.innerText = `Tỷ lệ chính xác: ${accuracy}%`;
        comparisonDisplay.innerHTML = comparisonHTML || "Bạn chưa nhập nội dung nào.";
        originalTextDisplay.innerText = originalText;
        resultArea.style.display = "block";
        
        // Cuộn xuống xem kết quả
        resultArea.scrollIntoView({ behavior: 'smooth' });
    }
</script>

</body>
</html>